<div class="form-preview">
    <!-- Error Summary -->
    <div *ngIf="hasErrors" class="error-summary" role="alert" aria-live="polite">
        <mat-icon>error_outline</mat-icon>
        <div class="error-message">
            <strong>Please fix the following errors:</strong>
            <ul>
                <li *ngFor="let error of getErrorMessages()">{{ error }}</li>
            </ul>
        </div>
    </div>

    <!-- Success Message -->
    <div *ngIf="successMessage" class="success-summary" role="status" aria-live="polite">
        <mat-icon>check_circle</mat-icon>
        <span>{{ successMessage }}</span>
    </div>

    <!-- Form Header -->
    <div class="form-header">
        <h2>{{ formConfig.title }}</h2>
        <p *ngIf="formConfig.description" class="form-description">{{ formConfig.description }}</p>
    </div>

    <form [formGroup]="form" class="preview-form" (ngSubmit)="onSubmit()">
        <div *ngFor="let field of formConfig.fields" class="form-field-wrapper" [class.hidden]="field.hidden"
            [class.has-error]="hasFieldError(field.name)">

            <!-- Text Input -->
            <mat-form-field *ngIf="field.type === 'text'" appearance="outline" class="full-width"
                [class.has-error]="hasFieldError(field.name)">
                <mat-label>{{ field.label }}<span *ngIf="field.required" class="required">*</span></mat-label>
                <input matInput [id]="field.name" [formControlName]="field.name" [placeholder]="field.placeholder || ''"
                    [attr.aria-label]="field.label"
                    [attr.aria-describedby]="field.description ? field.name + '-hint' : null" />
                <mat-hint *ngIf="field.description" [id]="field.name + '-hint'">{{ field.description }}</mat-hint>
                <mat-error *ngIf="hasFieldError(field.name)">{{ getFieldError(field.name) }}</mat-error>
            </mat-form-field>

            <!-- Email Input -->
            <mat-form-field *ngIf="field.type === 'email'" appearance="outline" class="full-width"
                [class.has-error]="hasFieldError(field.name)">
                <mat-label>{{ field.label }}<span *ngIf="field.required" class="required">*</span></mat-label>
                <input matInput type="email" [id]="field.name" [formControlName]="field.name"
                    [placeholder]="field.placeholder || ''" [attr.aria-label]="field.label"
                    [attr.aria-describedby]="field.description ? field.name + '-hint' : null" />
                <mat-hint *ngIf="field.description" [id]="field.name + '-hint'">{{ field.description }}</mat-hint>
                <mat-error *ngIf="hasFieldError(field.name)">{{ getFieldError(field.name) }}</mat-error>
            </mat-form-field>

            <!-- Password Input -->
            <mat-form-field *ngIf="field.type === 'password'" appearance="outline" class="full-width"
                [class.has-error]="hasFieldError(field.name)">
                <mat-label>{{ field.label }}<span *ngIf="field.required" class="required">*</span></mat-label>
                <input matInput type="password" [id]="field.name" [formControlName]="field.name"
                    [placeholder]="field.placeholder || ''" [attr.aria-label]="field.label"
                    [attr.aria-describedby]="field.description ? field.name + '-hint' : null" />
                <mat-hint *ngIf="field.description" [id]="field.name + '-hint'">{{ field.description }}</mat-hint>
                <mat-error *ngIf="hasFieldError(field.name)">{{ getFieldError(field.name) }}</mat-error>
            </mat-form-field>

            <!-- Number Input -->
            <mat-form-field *ngIf="field.type === 'number'" appearance="outline" class="full-width"
                [class.has-error]="hasFieldError(field.name)">
                <mat-label>{{ field.label }}<span *ngIf="field.required" class="required">*</span></mat-label>
                <input matInput type="number" [id]="field.name" [formControlName]="field.name"
                    [placeholder]="field.placeholder || ''" [attr.aria-label]="field.label"
                    [attr.aria-describedby]="field.description ? field.name + '-hint' : null" />
                <mat-hint *ngIf="field.description" [id]="field.name + '-hint'">{{ field.description }}</mat-hint>
                <mat-error *ngIf="hasFieldError(field.name)">{{ getFieldError(field.name) }}</mat-error>
            </mat-form-field>

            <!-- Date Input -->
            <mat-form-field *ngIf="field.type === 'date'" appearance="outline" class="full-width"
                [class.has-error]="hasFieldError(field.name)">
                <mat-label>{{ field.label }}<span *ngIf="field.required" class="required">*</span></mat-label>
                <input matInput [matDatepicker]="picker" [id]="field.name" [formControlName]="field.name"
                    [attr.aria-label]="field.label"
                    [attr.aria-describedby]="field.description ? field.name + '-hint' : null" />
                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
                <mat-hint *ngIf="field.description" [id]="field.name + '-hint'">{{ field.description }}</mat-hint>
                <mat-error *ngIf="hasFieldError(field.name)">{{ getFieldError(field.name) }}</mat-error>
            </mat-form-field>

            <!-- Textarea -->
            <mat-form-field *ngIf="field.type === 'textarea'" appearance="outline" class="full-width"
                [class.has-error]="hasFieldError(field.name)">
                <mat-label>{{ field.label }}<span *ngIf="field.required" class="required">*</span></mat-label>
                <textarea matInput [id]="field.name" [formControlName]="field.name" [rows]="field.rows || 4"
                    [placeholder]="field.placeholder || ''" [attr.aria-label]="field.label"
                    [attr.aria-describedby]="field.description ? field.name + '-hint' : null"></textarea>
                <mat-hint *ngIf="field.description" [id]="field.name + '-hint'">{{ field.description }}</mat-hint>
                <mat-error *ngIf="hasFieldError(field.name)">{{ getFieldError(field.name) }}</mat-error>
            </mat-form-field>

            <!-- Select -->
            <mat-form-field *ngIf="field.type === 'select'" appearance="outline" class="full-width"
                [class.has-error]="hasFieldError(field.name)">
                <mat-label>{{ field.label }}<span *ngIf="field.required" class="required">*</span></mat-label>
                <mat-select [id]="field.name" [formControlName]="field.name" [attr.aria-label]="field.label"
                    [attr.aria-describedby]="field.description ? field.name + '-hint' : null">
                    <mat-option value="">-- Select --</mat-option>
                    <mat-option *ngFor="let option of field.options" [value]="option.value"
                        [disabled]="option.disabled">
                        {{ option.label }}
                    </mat-option>
                </mat-select>
                <mat-hint *ngIf="field.description" [id]="field.name + '-hint'">{{ field.description }}</mat-hint>
                <mat-error *ngIf="hasFieldError(field.name)">{{ getFieldError(field.name) }}</mat-error>
            </mat-form-field>

            <!-- Checkbox -->
            <div *ngIf="field.type === 'checkbox'" class="checkbox-wrapper">
                <mat-checkbox [id]="field.name" [formControlName]="field.name" [attr.aria-label]="field.label">
                    {{ field.label }}
                    <span *ngIf="field.required" class="required" aria-label="required">*</span>
                </mat-checkbox>
                <p *ngIf="field.description" class="field-description" [id]="field.name + '-hint'">{{ field.description
                    }}</p>
                <mat-error *ngIf="hasFieldError(field.name)" class="checkbox-error">{{ getFieldError(field.name)
                    }}</mat-error>
            </div>

            <!-- Radio -->
            <div *ngIf="field.type === 'radio'" class="radio-wrapper">
                <label [id]="field.name + '-label'">{{ field.label }}<span *ngIf="field.required" class="required"
                        aria-label="required">*</span></label>
                <mat-radio-group [id]="field.name" [formControlName]="field.name"
                    [attr.aria-labelledby]="field.name + '-label'"
                    [attr.aria-describedby]="field.description ? field.name + '-hint' : null">
                    <mat-radio-button *ngFor="let option of field.options" [value]="option.value"
                        [disabled]="option.disabled">
                        {{ option.label }}
                    </mat-radio-button>
                </mat-radio-group>
                <p *ngIf="field.description" class="field-description" [id]="field.name + '-hint'">{{ field.description
                    }}</p>
                <mat-error *ngIf="hasFieldError(field.name)" class="radio-error">{{ getFieldError(field.name)
                    }}</mat-error>
            </div>

            <!-- File Input -->
            <div *ngIf="field.type === 'file'" class="file-input-wrapper">
                <label [for]="field.name">
                    {{ field.label }}
                    <span *ngIf="field.required" class="required" aria-label="required">*</span>
                </label>
                <input type="file" [id]="field.name" [formControlName]="field.name" [attr.aria-label]="field.label"
                    [attr.aria-describedby]="field.description ? field.name + '-hint' : null" />
                <p *ngIf="field.description" class="field-description" [id]="field.name + '-hint'">{{ field.description
                    }}</p>
                <mat-error *ngIf="hasFieldError(field.name)" class="file-error">{{ getFieldError(field.name)
                    }}</mat-error>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" mat-raised-button color="primary" [disabled]="form.invalid || isSubmitting">
                <mat-icon *ngIf="!isSubmitting">check</mat-icon>
                <mat-spinner *ngIf="isSubmitting" diameter="20" strokeWidth="2"></mat-spinner>
                {{ isSubmitting ? 'Submitting...' : (formConfig.submitButtonText || 'Submit') }}
            </button>
            <button type="reset" mat-stroked-button [disabled]="isSubmitting">
                <mat-icon>refresh</mat-icon>
                {{ formConfig.cancelButtonText || 'Reset' }}
            </button>
        </div>
    </form>
</div>