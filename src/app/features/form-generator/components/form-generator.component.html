<div class="form-generator-container">
    <div class="form-generator-wrapper">
        <app-page-header [title]="isEditMode ? 'Edit Form' : 'Form Generator (Create)'"
            [icon]="isEditMode ? 'edit' : 'edit_note'"
            [description]="isEditMode ? 'Edit your existing form. Make changes and save to update.' : 'Create dynamic forms by entering natural language prompts. The AI will generate a form structure based on your description.'">
        </app-page-header>
        <div class="page-content">
            <!-- Main Content -->
            <mat-card class="main-card">
                <!-- Form Generation Loader (appears on top when generating) -->
                <div *ngIf="isGenerating" class="generating-section">
                    <app-form-generation-loader></app-form-generation-loader>
                </div>

                <!-- Generated Form Preview -->
                <div *ngIf="generatedForm && !isGenerating" class="preview-section" #previewSection>
                    <mat-divider *ngIf="!isEditMode"></mat-divider>
                    <div class="section-header">
                        <h2>{{ isEditMode ? 'Edit Form' : 'Form Preview' }}</h2>
                        <div class="header-actions">
                            <button mat-raised-button color="primary" (click)="saveForm()">
                                <mat-icon>save</mat-icon>
                                {{ isEditMode ? 'Update Form' : 'Save Form' }}
                            </button>
                            <button mat-stroked-button (click)="discardForm()">
                                <mat-icon>close</mat-icon>
                                {{ isEditMode ? 'Cancel' : 'Discard' }}
                            </button>
                        </div>
                    </div>
                    <app-form-preview [formConfig]="generatedForm"></app-form-preview>
                </div>

                <!-- Prompt Input Section (hide when form is showing or generating) -->
                <mat-card-content *ngIf="!isEditMode && !generatedForm && !isGenerating">
                    <app-prompt-input (promptSubmit)="onPromptSubmit($event)"
                        [isLoading]="isGenerating"></app-prompt-input>
                </mat-card-content>

                <!-- Error/Success Message -->
                <div *ngIf="error" class="message-container" [class.success]="error.includes('successfully')">
                    <div class="message">
                        <mat-icon [class]="error.includes('successfully') ? 'success-icon' : 'error-icon'">
                            {{ error.includes('successfully') ? 'check_circle' : 'error' }}
                        </mat-icon>
                        <span>{{ error }}</span>
                    </div>
                </div>
            </mat-card>
        </div>
    </div>
</div>